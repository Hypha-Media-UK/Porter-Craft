{% extends "_layout" %}

{% block content %}
    <div class="header-with-nav">
        <h1>Supervisors Management</h1>
        <div class="nav-links">
            <a href="{{ siteUrl('staff') }}" class="btn">‚Üê Back to Staff Management</a>
        </div>
    </div>

    {# Display existing supervisors #}
    <div class="supervisors-list">
        <h2>Existing Supervisors</h2>
        {% set supervisors = craft.entries()
            .section('supervisors')
            .orderBy('title asc')
            .all() %}

        {% if supervisors|length %}
            <table class="supervisors-table">
                <thead>
                    <tr>
                        <th>First Name</th>
                        <th>Surname</th>
                    </tr>
                </thead>
                <tbody>
                    {% for supervisor in supervisors %}
                        <tr>
                            <td><a href="{{ supervisor.url }}">{{ supervisor.title }}</a></td>
                            <td>{{ supervisor.fd_surname }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p><em>No supervisors have been added yet.</em></p>
        {% endif %}
    </div>

    {# Form to add new supervisor #}
    <div class="add-supervisor-form">
        <h2>Add New Supervisor</h2>
        
        {% if success is defined %}
            <div class="notification success">
                Supervisor has been saved successfully!
            </div>
        {% endif %}

        {% set entry = entry is defined ? entry : craft.entries.section('supervisors').one() ?? create('craft\\elements\\Entry') %}
        
        <form method="post" accept-charset="UTF-8">
            {{ csrfInput() }}
            {{ actionInput('entries/save-entry') }}
            {{ redirectInput('supervisors/success?slug={slug}') }}
            {{ hiddenInput('sectionId', craft.app.entries.getSectionByHandle('supervisors').id) }}
            {{ hiddenInput('typeId', craft.app.entries.getSectionByHandle('supervisors').entryTypes[0].id) }}
            {{ hiddenInput('enabled', '1') }}
            {{ hiddenInput('slug', '__temp_' ~ now|date('U')) }}
            {{ successMessageInput('Supervisor has been added successfully!') }}
            
            <div class="field">
                <label for="title">First Name *</label>
                {{ input('text', 'title', entry.title, {
                    id: 'title',
                    required: true
                }) }}
                {% if entry is defined and entry.hasErrors('title') %}
                    <span class="error">{{ entry.getFirstError('title') }}</span>
                {% endif %}
            </div>
            
            <div class="field">
                <label for="fields-fd_surname">Surname *</label>
                {{ input('text', 'fields[fd_surname]', entry.fd_surname, {
                    id: 'fields-fd_surname',
                    required: true
                }) }}
                {% if entry is defined and entry.hasErrors('fd_surname') %}
                    <span class="error">{{ entry.getFirstError('fd_surname') }}</span>
                {% endif %}
            </div>
            
            <div class="submit">
                <button type="submit" class="btn">Add Supervisor</button>
            </div>
        </form>
    </div>
{% endblock %}
